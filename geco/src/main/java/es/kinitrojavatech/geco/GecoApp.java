/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package es.kinitrojavatech.geco;

import java.util.List;

import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;

import es.kinitrojavatech.geco.data.DataFile;
import es.kinitrojavatech.geco.gui.JPanelPasswords;
import es.kinitrojavatech.geco.xml.Category;

/**
 *
 * @author quique
 */
public class GecoApp extends javax.swing.JFrame {

	/**
	 * Creates new form GecoApp
	 */
	public GecoApp() {
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed" desc="Generated
	// <editor-fold defaultstate="collapsed" desc="Generated
	// Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		jToolBar1 = new javax.swing.JToolBar();
		jButtonOpen = new javax.swing.JButton();
		jButtonSave = new javax.swing.JButton();
		jTabbedPane1 = new javax.swing.JTabbedPane();
		jPanelPasswd = new javax.swing.JPanel();
		jTabbedPanePasswdCategories = new javax.swing.JTabbedPane();
		jPanelAccounts = new javax.swing.JPanel();
		jPanelEncFs = new javax.swing.JPanel();
		jPanelAbout = new javax.swing.JPanel();

		setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
		final java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("es/kinitrojavatech/geco/Bundle"); // NOI18N
		setTitle(bundle.getString("GecoApp.title")); // NOI18N
		setName("Form"); // NOI18N

		jToolBar1.setRollover(true);
		jToolBar1.setName("jToolBar1"); // NOI18N

		jButtonOpen.setText(bundle.getString("GecoApp.jButtonOpen.text")); // NOI18N
		jButtonOpen.setFocusable(false);
		jButtonOpen.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
		jButtonOpen.setName("jButtonOpen"); // NOI18N
		jButtonOpen.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
		jButtonOpen.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(final java.awt.event.ActionEvent evt) {
				jButtonOpenActionPerformed(evt);
			}
		});
		jToolBar1.add(jButtonOpen);

		jButtonSave.setText(bundle.getString("GecoApp.jButtonSave.text")); // NOI18N
		jButtonSave.setFocusable(false);
		jButtonSave.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
		jButtonSave.setName("jButtonSave"); // NOI18N
		jButtonSave.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
		jButtonSave.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(final java.awt.event.ActionEvent evt) {
				jButtonSaveActionPerformed(evt);
			}
		});
		jToolBar1.add(jButtonSave);

		getContentPane().add(jToolBar1, java.awt.BorderLayout.PAGE_START);

		jTabbedPane1.setName("jTabbedPane1"); // NOI18N

		jPanelPasswd.setName("jPanelPasswd"); // NOI18N

		jTabbedPanePasswdCategories.setMaximumSize(null);
		jTabbedPanePasswdCategories.setMinimumSize(null);
		jTabbedPanePasswdCategories.setName("jTabbedPanePasswdCategories"); // NOI18N
		jTabbedPanePasswdCategories.setPreferredSize(null);

		final javax.swing.GroupLayout jPanelPasswdLayout = new javax.swing.GroupLayout(jPanelPasswd);
		jPanelPasswd.setLayout(jPanelPasswdLayout);
		jPanelPasswdLayout.setHorizontalGroup(jPanelPasswdLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 795, Short.MAX_VALUE)
				.addGroup(jPanelPasswdLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(jPanelPasswdLayout.createSequentialGroup().addGap(0, 0, Short.MAX_VALUE)
								.addComponent(jTabbedPanePasswdCategories, javax.swing.GroupLayout.PREFERRED_SIZE,
										javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
								.addGap(0, 0, Short.MAX_VALUE))));
		jPanelPasswdLayout.setVerticalGroup(jPanelPasswdLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 442, Short.MAX_VALUE)
				.addGroup(jPanelPasswdLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(jPanelPasswdLayout.createSequentialGroup().addGap(0, 0, Short.MAX_VALUE)
								.addComponent(jTabbedPanePasswdCategories, javax.swing.GroupLayout.PREFERRED_SIZE,
										javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
								.addGap(0, 0, Short.MAX_VALUE))));

		jTabbedPane1.addTab(bundle.getString("GecoApp.jPanelPasswd.TabConstraints.tabTitle"), jPanelPasswd); // NOI18N

		jPanelAccounts.setName("jPanelAccounts"); // NOI18N

		final javax.swing.GroupLayout jPanelAccountsLayout = new javax.swing.GroupLayout(jPanelAccounts);
		jPanelAccounts.setLayout(jPanelAccountsLayout);
		jPanelAccountsLayout.setHorizontalGroup(jPanelAccountsLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 795, Short.MAX_VALUE));
		jPanelAccountsLayout.setVerticalGroup(jPanelAccountsLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 442, Short.MAX_VALUE));

		jTabbedPane1.addTab(bundle.getString("GecoApp.jPanelAccounts.TabConstraints.tabTitle"), jPanelAccounts); // NOI18N

		jPanelEncFs.setName("jPanelEncFs"); // NOI18N

		final javax.swing.GroupLayout jPanelEncFsLayout = new javax.swing.GroupLayout(jPanelEncFs);
		jPanelEncFs.setLayout(jPanelEncFsLayout);
		jPanelEncFsLayout.setHorizontalGroup(jPanelEncFsLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 795, Short.MAX_VALUE));
		jPanelEncFsLayout.setVerticalGroup(jPanelEncFsLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 442, Short.MAX_VALUE));

		jTabbedPane1.addTab(bundle.getString("GecoApp.jPanelEncFs.TabConstraints.tabTitle"), jPanelEncFs); // NOI18N

		jPanelAbout.setName("jPanelAbout"); // NOI18N

		final javax.swing.GroupLayout jPanelAboutLayout = new javax.swing.GroupLayout(jPanelAbout);
		jPanelAbout.setLayout(jPanelAboutLayout);
		jPanelAboutLayout.setHorizontalGroup(jPanelAboutLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 795, Short.MAX_VALUE));
		jPanelAboutLayout.setVerticalGroup(jPanelAboutLayout
				.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 442, Short.MAX_VALUE));

		jTabbedPane1.addTab(bundle.getString("GecoApp.jPanelAbout.TabConstraints.tabTitle"), jPanelAbout); // NOI18N

		getContentPane().add(jTabbedPane1, java.awt.BorderLayout.CENTER);

		pack();
		setLocationRelativeTo(null);
	}// </editor-fold>//GEN-END:initComponents

	private void jButtonOpenActionPerformed(final java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButtonOpenActionPerformed
		// TODO add your handling code here:
	}// GEN-LAST:event_jButtonOpenActionPerformed

	private void jButtonSaveActionPerformed(final java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButtonSaveActionPerformed
		dataFile.save();
		JOptionPane.showMessageDialog(this, "Los cambios han sido guardados", "Datos guardados",
				JOptionPane.INFORMATION_MESSAGE);
	}// GEN-LAST:event_jButtonSaveActionPerformed

	private void exitMenuItemActionPerformed(final java.awt.event.ActionEvent evt) {// GEN-FIRST:event_exitMenuItemActionPerformed
		System.exit(0);
	}// GEN-LAST:event_exitMenuItemActionPerformed

	/**
	 * @param args
	 *            the command line arguments
	 */
	public static void main(final String args[]) {
		/* Set the Nimbus look and feel */
		// <editor-fold defaultstate="collapsed" desc=" Look and feel setting
		// code (optional) ">
		/*
		 * If Nimbus (introduced in Java SE 6) is not available, stay with the
		 * default look and feel. For details see
		 * http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.
		 * html
		 */
		try {
			for (final javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
				if ("Nimbus".equals(info.getName())) {
					javax.swing.UIManager.setLookAndFeel(info.getClassName());
					break;
				}
			}
		} catch (final ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(GecoApp.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (final InstantiationException ex) {
			java.util.logging.Logger.getLogger(GecoApp.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (final IllegalAccessException ex) {
			java.util.logging.Logger.getLogger(GecoApp.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (final javax.swing.UnsupportedLookAndFeelException ex) {
			java.util.logging.Logger.getLogger(GecoApp.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		}
		// </editor-fold>

		/* Create and display the form */
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				final GecoApp app = new GecoApp();
				if (app.openDatafile()) {
					app.initComponents();
					app.initPanelPasswords();
					app.pack();
					app.setVisible(true);
				}
			}
		});
	}

	private DataFile dataFile;

	// Variables declaration - do not modify//GEN-BEGIN:variables
	javax.swing.JButton jButtonOpen;
	javax.swing.JButton jButtonSave;
	javax.swing.JPanel jPanelAbout;
	javax.swing.JPanel jPanelAccounts;
	javax.swing.JPanel jPanelEncFs;
	javax.swing.JPanel jPanelPasswd;
	javax.swing.JTabbedPane jTabbedPane1;
	javax.swing.JTabbedPane jTabbedPanePasswdCategories;
	javax.swing.JToolBar jToolBar1;
	// End of variables declaration//GEN-END:variables

	private boolean openDatafile() {
		final JFileChooser chooser = new JFileChooser();
		final FileNameExtensionFilter filter = new FileNameExtensionFilter("Ficheros de datos de geco", "geco");
		chooser.setFileFilter(filter);
		final int returnVal = chooser.showOpenDialog(this);
		if (returnVal == JFileChooser.APPROVE_OPTION) {
			dataFile = new DataFile(chooser.getSelectedFile());
			return dataFile.open();
		}
		return false;
	}

	private void initPanelPasswords() {
		final List<Category> categories = dataFile.getData().getPasswords().getCategory();

		for (final Category category : categories) {
			final JPanelPasswords panel = new JPanelPasswords(category);
			jTabbedPanePasswdCategories.add(category.getTitle(), panel);
		}
	}
}
